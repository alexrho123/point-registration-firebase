<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-100">

  <!-- Login Modal -->
  <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
      <h2 class="text-2xl font-bold mb-4">Admin Login</h2>
      <form id="loginForm" class="space-y-4">
        <label class="block">
          Username
          <input type="text" id="loginUsername" required class="w-full border px-3 py-2 rounded"/>
        </label>
        <label class="block">
          Password
          <input type="password" id="loginPassword" required class="w-full border px-3 py-2 rounded"/>
        </label>
        <div class="text-right">
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Login</button>
        </div>
      </form>
    </div>
  </div>

  <!-- App Content -->
  <div id="appContent" class="hidden">

    <!-- Navbar -->
    <nav class="bg-white shadow p-4 flex justify-between">
      <h1 class="text-xl font-bold">Admin Panel</h1>
      <button id="logoutBtn" class="bg-red-500 text-white px-3 py-1 rounded">Logout</button>
    </nav>

    <!-- Tabs -->
    <div class="p-4">
      <ul id="tabs" class="flex space-x-4 border-b">
        <li data-tab="dashboard" class="pb-2 border-b-2 border-blue-600 cursor-pointer">Dashboard</li>
        <li data-tab="orders" class="pb-2 cursor-pointer">Orders</li>
        <li data-tab="customers" class="pb-2 cursor-pointer">Customers</li>
        <li data-tab="products" class="pb-2 cursor-pointer">Products</li>
      </ul>

      <!-- Dashboard -->
      <div id="dashboard" class="tab-content p-4">
        <div class="grid grid-cols-3 gap-4">
          <div class="bg-white p-4 rounded shadow">
            <h2 class="text-lg font-semibold">Total Orders</h2>
            <p id="totalOrders" class="text-2xl"></p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <h2 class="text-lg font-semibold">Total Revenue</h2>
            <p id="totalRevenue" class="text-2xl"></p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <h2 class="text-lg font-semibold">Customers</h2>
            <p id="totalCustomers" class="text-2xl"></p>
          </div>
        </div>
      </div>

      <!-- Orders -->
      <div id="orders" class="tab-content hidden p-4">
        <h2 class="text-lg font-semibold mb-2">Live Orders</h2>
        <table class="min-w-full bg-white">
          <thead>
            <tr>
              <th class="px-4 py-2">Customer</th>
              <th class="px-4 py-2">Total (€)</th>
              <th class="px-4 py-2">Timestamp</th>
            </tr>
          </thead>
          <tbody id="ordersTable"></tbody>
        </table>
      </div>

      <!-- Customers -->
      <div id="customers" class="tab-content hidden p-4">
        <h2 class="text-lg font-semibold mb-2">Customers</h2>
        <table class="min-w-full bg-white mb-4">
          <thead>
            <tr>
              <th class="px-4 py-2">Name</th>
              <th class="px-4 py-2">Phone</th>
              <th class="px-4 py-2">Address</th>
            </tr>
          </thead>
          <tbody id="customersTable"></tbody>
        </table>
        <div id="customerDetails" class="bg-white p-4 rounded shadow hidden"></div>
      </div>

      <!-- Products -->
      <div id="products" class="tab-content hidden p-4">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">Products</h2>
          <button id="addProductBtn" class="bg-green-600 text-white px-3 py-1 rounded">Add Product</button>
        </div>
        <table class="min-w-full bg-white">
          <thead>
            <tr>
              <th class="px-4 py-2">Name</th>
              <th class="px-4 py-2">Price</th>
              <th class="px-4 py-2">Actions</th>
            </tr>
          </thead>
          <tbody id="productsTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Add Product Modal -->
  <div id="productModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
      <h2 class="text-xl font-bold mb-4">Add Product</h2>
      <form id="productForm" class="space-y-4">
        <label class="block">
          Name
          <input type="text" id="productName" required class="w-full border px-3 py-2 rounded"/>
        </label>
        <label class="block">
          Price
          <input type="number" id="productPrice" required class="w-full border px-3 py-2 rounded"/>
        </label>
        <div class="text-right">
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Firebase init
    const firebaseConfig = { /*...*/ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Login logic
    const loginModal = document.getElementById("loginModal"),
          loginForm = document.getElementById("loginForm"),
          appContent = document.getElementById("appContent"),
          logoutBtn = document.getElementById("logoutBtn");
    loginForm.addEventListener("submit", async e => {
      e.preventDefault();
      const user = document.getElementById("loginUsername").value.trim();
      const pass = document.getElementById("loginPassword").value;
      const doc = await db.collection("admins").doc(user).get();
      if (doc.exists && doc.data().password === pass) {
        loginModal.classList.add("hidden");
        appContent.classList.remove("hidden");
      } else {
        alert("Invalid credentials");
      }
    });
    logoutBtn.addEventListener("click", () => {
      window.location.reload();
    });

    // Tab switching
    document.querySelectorAll("#tabs li").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab-content").forEach(c => c.classList.add("hidden"));
        document.getElementById(tab.dataset.tab).classList.remove("hidden");
        document.querySelectorAll("#tabs li").forEach(t => t.classList.remove("border-blue-600"));
        tab.classList.add("border-blue-600");
      });
    });

    // Dashboard stats
    async function updateDashboard() {
      const ordersSnap = await db.collection("orders").get();
      document.getElementById("totalOrders").textContent = ordersSnap.size;
      let revenue = 0;
      ordersSnap.docs.forEach(d => revenue += d.data().total);
      document.getElementById("totalRevenue").textContent = revenue.toFixed(2) + " €";
      const customersSnap = await db.collection("clients").get();
      document.getElementById("totalCustomers").textContent = customersSnap.size;
    }

    // Live orders
    db.collection("orders").onSnapshot(snap => {
      const tbody = document.getElementById("ordersTable");
      tbody.innerHTML = "";
      snap.docs.forEach(doc => {
        const d = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="border px-4 py-2">${d.clientName}</td>
          <td class="border px-4 py-2">${d.total.toFixed(2)}</td>
          <td class="border px-4 py-2">${new Date(d.timestamp.toDate()).toLocaleString()}</td>`;
        tbody.appendChild(tr);
      });
    });

    // Customers list
    db.collection("clients").onSnapshot(snap => {
      const tbody = document.getElementById("customersTable");
      tbody.innerHTML = "";
      snap.docs.forEach(doc => {
        const d = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="border px-4 py-2 cursor-pointer">${d.name}</td>
          <td class="border px-4 py-2">${d.phone || ""}</td>
          <td class="border px-4 py-2">${d.address || ""}</td>`;
        tr.addEventListener("click", () => showClientDetails(doc.id));
        tbody.appendChild(tr);
      });
    });

    async function showClientDetails(id) {
      const doc = await db.collection("clients").doc(id).get();
      const d = doc.data();
      const details = document.getElementById("customerDetails");
      details.classList.remove("hidden");
      details.innerHTML = \`
        <h3 class="text-lg font-bold mb-2">\${d.name}</h3>
        <p><strong>Address:</strong> \${d.address || '—'}</p>
        <p><strong>Phone:</strong> \${d.phone || '—'}</p>
      \`;
    }

    // Products CRUD
    const productModal = document.getElementById("productModal"),
          addProductBtn = document.getElementById("addProductBtn"),
          productForm = document.getElementById("productForm");
    addProductBtn.addEventListener("click", () => productModal.classList.remove("hidden"));
    productForm.addEventListener("submit", async e => {
      e.preventDefault();
      const name = document.getElementById("productName").value.trim();
      const price = parseFloat(document.getElementById("productPrice").value);
      await db.collection("products").add({ name, price });
      productForm.reset();
      productModal.classList.add("hidden");
    });
    db.collection("products").onSnapshot(snap => {
      const tbody = document.getElementById("productsTable");
      tbody.innerHTML = "";
      snap.docs.forEach(doc => {
        const d = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = \`
          <td class="border px-4 py-2">\${d.name}</td>
          <td class="border px-4 py-2">\${d.price.toFixed(2)}</td>
          <td class="border px-4 py-2">
            <button data-id="\${doc.id}" class="deleteProduct text-red-500">Delete</button>
          </td>\`;
        tbody.appendChild(tr);
      });
      document.querySelectorAll(".deleteProduct").forEach(btn => {
        btn.addEventListener("click", async () => {
          await db.collection("products").doc(btn.dataset.id).delete();
        });
      });
    });

    // Initialize Dashboard on load
    updateDashboard();
  </script>
</body>
</html>
