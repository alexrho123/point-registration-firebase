<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Admin Panel – Διαχείριση</title>

  <!-- Tailwind CSS + custom colors -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1D4ED8',
            accent:  '#FACC15',
            danger:  '#DC2626',
            success: '#16A34A',
            region:  '#8B5CF6',
            softbg:  '#f0f8ff',
            darktext:'#1f2937'
          }
        }
      }
    }
  </script>

  <style>
    /* Όλα τα modals με fade */
    #addProductModal,
    #liveOrdersModal,
    #executedOrdersModal,
    #orderDetailModal,
    #addSellerModal {
      transition: opacity 0.2s ease;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-softbg text-darktext min-h-screen flex flex-col">

  <!-- Header & Nav -->
  <header class="w-full bg-white shadow">
    <div class="max-w-3xl mx-auto px-4 py-3 flex flex-col sm:flex-row items-center justify-between">
      <h1 class="text-2xl font-extrabold text-primary uppercase">Admin Panel</h1>
      <nav class="mt-2 sm:mt-0 flex space-x-2">
        <a href="index.html" class="px-3 py-1 bg-region text-white rounded uppercase text-sm hover:bg-region/90">Αρχική</a>
        <a href="admin.html"  class="px-3 py-1 bg-accent text-white rounded uppercase text-sm hover:bg-accent/90">Admin</a>
      </nav>
    </div>
  </header>

  <!-- Login -->
  <div id="loginContainer" class="flex-1 flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-sm">
      <h2 class="text-2xl font-bold text-center mb-6">Admin Login</h2>
      <form id="loginForm" class="space-y-4">
        <div>
          <label class="block mb-1">Όνομα χρήστη</label>
          <input id="username" type="text" required class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-primary"/>
        </div>
        <div>
          <label class="block mb-1">Κωδικός</label>
          <input id="password" type="password" required class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-primary"/>
        </div>
        <button type="submit" class="w-full bg-primary text-white py-2 rounded-lg hover:bg-primary/90">Σύνδεση</button>
      </form>
    </div>
  </div>

  <!-- Main Panel -->
  <div id="adminPanel" class="hidden flex-1 w-full max-w-3xl mx-auto p-6 flex flex-col gap-8">
    <h1 class="text-3xl font-bold text-primary mb-4 text-center">Πίνακας Διαχείρισης</h1>
    <div class="grid grid-cols-1 sm:grid-cols-4 gap-6">
      <!-- Προσθήκη Προϊόντων -->
      <div id="addProductsCard" class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition p-6 cursor-pointer flex flex-col items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-accent mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h18M3 12h18M3 17h18" />
        </svg>
        <h2 class="text-xl font-semibold">Προσθήκη Προϊόντων</h2>
      </div>
      <!-- Live Παραγγελίες -->
      <div id="liveOrdersCard" class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition p-6 cursor-pointer flex flex-col items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-primary mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 6h18M3 14h18M3 18h18" />
        </svg>
        <h2 class="text-xl font-semibold">Live Παραγγελίες</h2>
      </div>
      <!-- Εκτελεσμένες Παραγγελίες -->
      <div id="executedOrdersCard" class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition p-6 cursor-pointer flex flex-col items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-success mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <h2 class="text-xl font-semibold">Εκτελεσμένες Παραγγελίες</h2>
      </div>
      <!-- Προσθήκη Πωλητή -->
      <div id="addSellerCard" class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition p-6 cursor-pointer flex flex-col items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-indigo-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 15c2.89 0 5.557.93 7.879 2.804M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <h2 class="text-xl font-semibold">Προσθήκη Πωλητή</h2>
      </div>
    </div>
  </div>

  <!-- Add Products Modal -->
  <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center opacity-0 pointer-events-none">
    <div class="bg-white rounded-lg w-full max-w-lg p-6 relative">
      <button onclick="closeAddProductModal()" class="absolute top-3 right-3 text-gray-600 hover:text-gray-800 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold text-primary mb-4 text-center">Προσθήκη Προϊόντων</h2>
      <form id="productForm" class="space-y-4">
        <div id="productRows" class="space-y-2">
          <div class="flex gap-2">
            <input type="text" placeholder="Όνομα προϊόντος" required class="flex-1 border px-3 py-2 rounded focus:ring-2 focus:ring-region"/>
            <input type="number" placeholder="Τιμή" step="0.01" required class="w-24 border px-3 py-2 rounded focus:ring-2 focus:ring-region"/>
            <button type="button" onclick="removeRow(this)" class="text-danger hover:text-red-700 text-2xl leading-none">&minus;</button>
          </div>
        </div>
        <div class="flex justify-between">
          <button type="button" onclick="addRow()" class="bg-accent text-white px-4 py-2 rounded hover:bg-accent/90">+ Νέα Γραμμή</button>
          <div class="space-x-2">
            <button type="button" onclick="closeAddProductModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Ακύρωση</button>
            <button type="submit" class="bg-success text-white px-4 py-2 rounded hover:bg-success/90">Αποθήκευση</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Live Orders Modal -->
  <div id="liveOrdersModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center opacity-0 pointer-events-none">
    <div class="bg-white rounded-lg w-full max-w-2xl p-6 relative">
      <button onclick="closeLiveOrdersModal()" class="absolute top-3 right-3 text-gray-600 hover:text-gray-800 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold text-primary mb-4 text-center">Ζωντανές Παραγγελίες</h2>
      <div id="ordersList" class="space-y-3 max-h-80 overflow-auto"></div>
    </div>
  </div>

  <!-- Executed Orders Modal -->
  <div id="executedOrdersModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center opacity-0 pointer-events-none">
    <div class="bg-white rounded-lg w-full max-w-2xl p-6 relative">
      <button onclick="closeExecutedOrdersModal()" class="absolute top-3 right-3 text-gray-600 hover:text-gray-800 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold text-success mb-4 text-center">Εκτελεσμένες Παραγγελίες</h2>
      <div id="executedList" class="space-y-3 max-h-80 overflow-auto"></div>
    </div>
  </div>

  <!-- Order Detail Modal -->
  <div id="orderDetailModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center opacity-0 pointer-events-none">
    <div class="bg-white rounded-2xl w-full max-w-xl p-8 relative shadow-2xl">
      <button onclick="closeOrderDetailModal()" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 text-3xl">&times;</button>
      <h2 id="detailTitle" class="text-2xl font-bold text-primary mb-6 text-center uppercase">ΛΕΠΤΟΜΕΡΕΙΕΣ ΠΑΡΑΓΓΕΛΙΑΣ</h2>

      <!-- Responsive item list -->
      <div id="detailContent" class="bg-white rounded-lg overflow-hidden shadow-inner"></div>

      <!-- Παρατηρήσεις -->
      <div class="mt-6">
        <h3 class="text-lg font-semibold mb-2">Παρατηρήσεις</h3>
        <div id="detailRemarks" class="border border-gray-200 rounded-lg p-4 bg-gray-50 italic text-gray-700 text-sm min-h-[3rem]"></div>
      </div>

      <!-- Σύνολο -->
      <div class="mt-6 flex justify-between font-bold text-lg uppercase">
        <span>Σύνολο:</span>
        <span id="detailTotal" class="text-primary">€0.00</span>
      </div>

      <!-- Buttons -->
      <div class="mt-6 flex flex-col sm:flex-row justify-between gap-3">
        <button id="executeOrderBtn" class="w-full sm:w-auto bg-success text-white px-6 py-2 rounded-lg hover:bg-success/90">Εκτέλεση Παραγγελίας</button>
        <button id="cancelOrderBtn"  class="w-full sm:w-auto bg-danger text-white px-6 py-2 rounded-lg hover:bg-danger/90">Ακύρωση Παραγγελίας</button>
      </div>
    </div>
  </div>

  <!-- Add Seller Modal -->
  <div id="addSellerModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center opacity-0 pointer-events-none">
    <div class="bg-white rounded-2xl w-full max-w-md p-8 relative shadow-2xl">
      <button onclick="closeAddSellerModal()" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 text-3xl">&times;</button>
      <h2 class="text-2xl font-bold text-primary mb-6 text-center">Προσθήκη Πωλητή</h2>
      <form id="sellerForm" class="space-y-4">
        <div>
          <label class="block mb-1">Ονοματεπώνυμο</label>
          <input id="sellerName"     type="text"     required class="w-full border px-3 py-2 rounded-lg focus:ring-2 focus:ring-region"/>
        </div>
        <div>
          <label class="block mb-1">Username</label>
          <input id="sellerUsername" type="text"     required class="w-full border px-3 py-2 rounded-lg focus:ring-2 focus:ring-region"/>
        </div>
        <div>
          <label class="block mb-1">Password</label>
          <input id="sellerPassword" type="password" required class="w-full border px-3 py-2 rounded-lg focus:ring-2 focus:ring-region"/>
        </div>
        <div>
          <label class="block mb-1">Ρόλος</label>
          <select id="sellerRole" required class="w-full border px-3 py-2 rounded-lg focus:ring-2 focus:ring-region">
            <option value="admin">Admin</option>
            <option value="seller">Πωλητής</option>
          </select>
        </div>
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="closeAddSellerModal()" class="px-5 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Ακύρωση</button>
          <button type="submit" class="px-5 py-2 bg-success text-white rounded-lg hover:bg-success/90">Αποθήκευση</button>
        </div>
      </form>
    </div>
  </div>

  <!-- JS -->
  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey:    "AIzaSyDe966NdE-AW_eZrDCEKjw8y2h5mSdHr6o",
      authDomain:"pointregistrationapp.firebaseapp.com",
      projectId: "pointregistrationapp",
      storageBucket:"pointregistrationapp.appspot.com",
      messagingSenderId:"925139386507",
      appId:     "1:925139386507:web:588ae991f39a7bab04548e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Login
    document.getElementById('loginForm').onsubmit = async e => {
      e.preventDefault();
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value;
      const doc = await db.collection('users').doc(u).get();
      if (!doc.exists) {
        if (u==='admin'&&p==='123') await db.collection('users').doc(u).set({password:'123',role:'admin'});
        else return alert('Σφάλμα σύνδεσης');
      }
      const data = (await db.collection('users').doc(u).get()).data();
      if (data.password===p) {
        document.getElementById('loginContainer').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
      } else alert('Σφάλμα σύνδεσης');
    };

    // Add/Remove products, Live/Executed orders etc. (όπως είχες)

    // Order Detail
    const detailContent    = document.getElementById('detailContent'),
          detailRemarks    = document.getElementById('detailRemarks'),
          detailTotal      = document.getElementById('detailTotal'),
          executeOrderBtn  = document.getElementById('executeOrderBtn'),
          cancelOrderBtn   = document.getElementById('cancelOrderBtn');
    let currentOrderRef = null;

    async function openOrderDetail(ref, pname){
      currentOrderRef = ref;
      detailContent.innerHTML = '';
      detailRemarks.textContent = '';
      detailTotal.textContent = '€0.00';
      document.getElementById('detailTitle')
              .textContent = `ΠΑΡΑΓΓΕΛΙΑ @ ${pname}`
                .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
                .toUpperCase();
      document.getElementById('orderDetailModal')
              .classList.remove('opacity-0','pointer-events-none');

      const odoc = await ref.get();
      const od   = odoc.data();
      detailRemarks.textContent = od.remarks || '';

      let sum = 0;
      const itemsSnap = await ref.collection('items').get();
      for (let it of itemsSnap.docs) {
        const itm = it.data();
        const ps  = await itm.productId.get();
        const name = (ps.exists ? ps.data().name : itm.productId.id)
                       .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
                       .toUpperCase();
        const qty = itm.quantity, sub = itm.subtotal; sum += sub;

        const row = document.createElement('div');
        row.className = 'flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 px-4 border-b';
        row.innerHTML = `
          <div class="flex-1 font-medium">${qty}× ${name}</div>
          <div class="flex items-center gap-4 mt-2 sm:mt-0">
            <span class="w-8 text-center text-sm">${qty}</span>
            <span class="w-16 text-right text-sm">€${sub.toFixed(2)}</span>
          </div>`;
        detailContent.appendChild(row);
      }
      detailTotal.textContent = `€${sum.toFixed(2)}`;
    }
    function closeOrderDetailModal(){
      document.getElementById('orderDetailModal')
              .classList.add('opacity-0','pointer-events-none');
    }

    // Εκτέλεση / Ακύρωση
    executeOrderBtn.onclick = async ()=>{
      if (!currentOrderRef) return;
      if (!confirm('Εκτέλεση παραγγελίας;')) return;
      await currentOrderRef.update({
        executed:true,
        executedAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      closeOrderDetailModal();
    };
    cancelOrderBtn.onclick = async ()=>{
      if (!currentOrderRef) return;
      if (!confirm('Διαγραφή παραγγελίας;')) return;
      const itemsSnap = await currentOrderRef.collection('items').get();
      for (let it of itemsSnap.docs) await it.ref.delete();
      await currentOrderRef.delete();
      closeOrderDetailModal();
    };

    // Add Seller Modal (όπως πριν)
    const addSellerModal = document.getElementById('addSellerModal');
    document.getElementById('addSellerCard').onclick = ()=> addSellerModal.classList.remove('opacity-0','pointer-events-none');
    function closeAddSellerModal(){
      addSellerModal.classList.add('opacity-0','pointer-events-none');
      document.getElementById('sellerForm').reset();
    }
    document.getElementById('sellerForm').onsubmit = async e=>{
      e.preventDefault();
      const name = document.getElementById('sellerName').value.trim();
      const user = document.getElementById('sellerUsername').value.trim();
      const pass = document.getElementById('sellerPassword').value;
      const role = document.getElementById('sellerRole').value;
      if(!name||!user||!pass) return alert('Συμπληρώστε όλα τα πεδία.');
      await db.collection('users').add({displayName:name,username:user,password:pass,role});
      alert('Ο πωλητής καταχωρήθηκε.');
      closeAddSellerModal();
    };

    function initAdmin(){ /* ό,τι χρειάζεται μετά το login */ }
  </script>
</body>
</html>
