<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Î Î¯Î½Î±ÎºÎ±Ï‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
        extend: {
          colors: {
            primary: { DEFAULT:'#4f46e5', light:'#6366f1', dark:'#4338ca' },
            accent:  { DEFAULT:'#f59e0b', light:'#fbbf24', dark:'#d97706' },
            region:'#8b5cf6', danger:'#dc2626', success:'#16a34a', softbg:'#f8fafc', glass:'rgba(255,255,255,0.6)'
          },
          boxShadow: { strong:'0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05)' },
          borderRadius: { xl:'1.5rem','2xl':'2rem' }
        }
      },
      plugins:[function({addUtilities}){ addUtilities({'.backdrop-glass':{'backdrop-filter':'blur(10px)'}}) }]
    };
  </script>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-softbg font-sans text-darktext min-h-screen flex flex-col items-center">

  <!-- Login Modal -->
  <div id="loginModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 shadow-strong w-full max-w-md relative">
      <button onclick="document.getElementById('loginModal').classList.add('hidden')" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">âœ•</button>
      <h2 class="text-2xl font-semibold text-primary mb-4 text-center">Î£ÏÎ½Î´ÎµÏƒÎ· Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®</h2>
      <form id="loginForm" class="space-y-4">
        <input id="loginUsername" type="text" placeholder="ÎŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·" required class="w-full px-4 py-2 border rounded-lg"/>
        <input id="loginPassword" type="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚" required class="w-full px-4 py-2 border rounded-lg"/>
        <button type="submit" class="w-full bg-primary text-white py-2 rounded-xl">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
      </form>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="appContent" class="hidden w-full max-w-6xl flex flex-col flex-1">
    <!-- Navbar -->
    <nav class="w-full bg-white shadow px-6 py-4 flex justify-between items-center">
      <h1 class="text-3xl font-bold text-primary">Î Î¯Î½Î±ÎºÎ±Ï‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚</h1>
      <button id="logoutBtn" class="bg-danger text-white px-4 py-2 rounded-xl">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</button>
    </nav>
    <!-- Tabs -->
    <div class="w-full bg-white px-6">
      <ul id="tabs" class="flex space-x-4 border-b">
        <li data-tab="users" class="py-2 cursor-pointer hover:text-primary">Î§ÏÎ®ÏƒÏ„ÎµÏ‚</li>
        <li data-tab="products" class="py-2 cursor-pointer hover:text-primary">Î ÏÎ¿ÏŠÏŒÎ½Ï„Î±</li>
        <li data-tab="points" class="py-2 cursor-pointer hover:text-primary">Î£Î·Î¼ÎµÎ¯Î±</li>
        <li data-tab="orders" class="py-2 cursor-pointer hover:text-primary">Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯ÎµÏ‚</li>
      </ul>
    </div>
    <main class="flex-1 overflow-auto p-6 bg-softbg">
      <!-- Users -->
      <section id="users" class="tab-content hidden flex flex-col items-center">
        <button id="addUserBtn" class="mb-4 bg-success text-white px-4 py-2 rounded-xl">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î§ÏÎ®ÏƒÏ„Î·</button>
        <div id="usersContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full"></div>
      </section>
      <!-- Products -->
      <section id="products" class="tab-content hidden flex flex-col items-center">
        <button id="addProductBtn" class="mb-4 bg-success text-white px-4 py-2 rounded-xl">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚</button>
        <div id="productsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full"></div>
      </section>
      <!-- Points -->
      <section id="points" class="tab-content hidden flex flex-col items-center">
        <div id="pointsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full"></div>
      </section>
      <!-- Orders -->
      <section id="orders" class="tab-content hidden flex flex-col items-center">
        <table class="w-full bg-white rounded-2xl shadow-strong overflow-hidden">
          <thead class="bg-primary text-white">
            <tr><th class="px-4 py-2">Î£Î·Î¼ÎµÎ¯Î¿</th><th class="px-4 py-2">Î£ÏÎ½Î¿Î»Î¿ (â‚¬)</th><th class="px-4 py-2">ÎÏÎ±</th><th class="px-4 py-2">Î”Î¹Î±Î³ÏÎ±Ï†Î®</th></tr>
          </thead>
          <tbody id="ordersTable"></tbody>
        </table>
      </section>
    </main>
  </div>

  <!-- Modals -->
  <div id="userModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 shadow-strong w-full max-w-md relative">
      <button onclick="closeModal('userModal')" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">âœ•</button>
      <h3 class="text-xl font-semibold mb-4">ÎÎ­Î¿Ï‚ Î§ÏÎ®ÏƒÏ„Î·Ï‚</h3>
      <form id="userForm" class="space-y-3">
        <input id="userName" placeholder="ÎŒÎ½Î¿Î¼Î±" required class="w-full px-3 py-2 border rounded-lg"/>
        <input id="userUsername" placeholder="Username" required class="w-full px-3 py-2 border rounded-lg"/>
        <input id="userRole" placeholder="Î¡ÏŒÎ»Î¿Ï‚" required class="w-full px-3 py-2 border rounded-lg"/>
        <input id="userPass" type="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚" required class="w-full px-3 py-2 border rounded-lg"/>
        <button type="submit" class="w-full bg-primary text-white py-2 rounded-xl">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
      </form>
    </div>
  </div>
  <div id="productModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 shadow-strong w-full max-w-md relative">
      <button onclick="closeModal('productModal')" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">âœ•</button>
      <h3 class="text-xl font-semibold mb-4">ÎÎ­Î¿ Î ÏÎ¿ÏŠÏŒÎ½</h3>
      <form id="productForm" class="space-y-3">
        <input id="productNameInput" placeholder="ÎŒÎ½Î¿Î¼Î±" required class="w-full px-3 py-2 border rounded-lg"/>
        <input id="productPriceInput" type="number" placeholder="Î¤Î¹Î¼Î®" required class="w-full px-3 py-2 border rounded-lg"/>
        <button type="submit" class="w-full bg-primary text-white py-2 rounded-xl">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
      </form>
    </div>
  </div>

  <script>
    // Firebase init
    firebase.initializeApp({apiKey:"AIzaSy...",authDomain:"pointregistrationapp.firebaseapp.com",projectId:"pointregistrationapp",storageBucket:"pointregistrationapp.appspot.com",messagingSenderId:"925139386507",appId:"1:925139386507:web:..."});
    const db = firebase.firestore();

    // Close modal helper
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    document.addEventListener("DOMContentLoaded", ()=>{
      const loginForm=document.getElementById("loginForm"), loginModal=document.getElementById("loginModal"), appContent=document.getElementById("appContent"), logoutBtn=document.getElementById("logoutBtn");
      loginForm.addEventListener("submit", async e => {
        e.preventDefault();
        const user=document.getElementById("loginUsername").value.trim(), pass=document.getElementById("loginPassword").value;
        const doc=await db.collection("admins").doc(user).get();
        if(doc.exists&&doc.data().password===pass){ loginModal.classList.add("hidden"); appContent.classList.remove("hidden"); initAdmin(); }
        else alert("Î›Î¬Î¸Î¿Ï‚ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±");
      });
      logoutBtn.addEventListener("click", ()=> location.reload());
      document.querySelectorAll("[data-tab]").forEach(btn=>btn.addEventListener("click", ()=>{
        document.querySelectorAll(".tab-content").forEach(s=>s.classList.add("hidden"));
        document.getElementById(btn.dataset.tab).classList.remove("hidden");
      }));
    });

    // Card builders...
    function clientCard(c){ const d=document.createElement("div"); d.className="relative bg-gradient-to-br from-primary-light to-primary-dark rounded-2xl p-6 shadow-strong transform hover:scale-105 transition"; d.innerHTML=`<div class="absolute top-3 left-1/2 -translate-x-1/2 bg-accent text-white px-3 py-1 rounded-full text-xs uppercase">Î§ÏÎ®ÏƒÏ„Î·Ï‚</div><h3 class="mt-8 text-center text-xl font-semibold text-white uppercase">${c.name}</h3><p class="mt-2 text-white/80 text-center">username: ${c.username}</p><p class="text-white/80 text-center">role: ${c.role}</p>`; return d; }
    function productCard(p){ const d=document.createElement("div"); d.className="bg-white rounded-2xl p-6 shadow-strong"; d.innerHTML=`<h3 class="text-xl font-semibold text-primary mb-2">${p.name}</h3><p class="text-gray-700">â‚¬${p.price.toFixed(2)}</p>`; return d; }
    function pointCard(p){ const d=document.createElement("div"); d.className="relative bg-white rounded-2xl p-6 shadow-strong"; d.innerHTML=`<div class="absolute top-3 left-1/2 -translate-x-1/2 bg-region text-white px-3 py-1 rounded-full text-xs uppercase">${p.area}</div><h3 class="mt-8 text-darktext text-center text-xl font-semibold uppercase">${p.name}</h3><div class="mt-4 flex justify-center space-x-2"><button onclick="editPoint('${p.id}')" class="px-3 py-1 bg-accent text-white rounded">âœ</button><button onclick="deletePoint('${p.id}')" class="px-3 py-1 bg-danger text-white rounded">ğŸ—‘</button></div>`; return d; }

    function initAdmin(){
      document.querySelector("[data-tab='users']").click();
      db.collection("users").orderBy("name").onSnapshot(s=>{ const cont=document.getElementById("usersContainer"); cont.innerHTML=""; s.docs.forEach(d=>cont.appendChild(clientCard({...d.data(),id:d.id}))); });
      document.getElementById("addUserBtn").onclick=()=>document.getElementById("userModal").classList.remove("hidden");
      document.getElementById("userForm").onsubmit=async e=>{e.preventDefault(); await db.collection("users").add({ name:document.getElementById("userName").value.trim(), username:document.getElementById("userUsername").value.trim(), role:document.getElementById("userRole").value.trim(), password:document.getElementById("userPass").value }); closeModal('userModal'); };
      db.collection("products").orderBy("name").onSnapshot(s=>{ const cont=document.getElementById("productsContainer"); cont.innerHTML=""; s.docs.forEach(d=>cont.appendChild(productCard({...d.data(),id:d.id}))); });
      document.getElementById("addProductBtn").onclick=()=>document.getElementById("productModal").classList.remove("hidden");
      document.getElementById("productForm").onsubmit=async e=>{e.preventDefault(); await db.collection("products").add({ name:document.getElementById("productNameInput").value.trim(), price:parseFloat(document.getElementById("productPriceInput").value) }); closeModal('productModal'); };
      db.collection("points").orderBy("timestamp","desc").onSnapshot(s=>{ const cont=document.getElementById("pointsContainer"); cont.innerHTML=""; s.docs.forEach(d=>cont.appendChild(pointCard({...d.data(),id:d.id}))); });
      window.deletePoint=id=>{ if(confirm("Î”Î¹Î±Î³ÏÎ±Ï†Î® ÏƒÎ·Î¼ÎµÎ¯Î¿Ï…;")) db.collection("points").doc(id).delete(); };
      window.editPoint=id=>{ alert("Î¥Î»Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î³Î¹Î±: "+id); };
      db.collectionGroup("orders").orderBy("timestamp","desc").onSnapshot(s=>{ const tb=document.getElementById("ordersTable"); tb.innerHTML=""; s.docs.forEach(async odDoc=>{ const od=odDoc.data(), pointRef=odDoc.ref.parent.parent; const pd=await pointRef.get(); const pointName=pd.exists?pd.data().name:pointRef.id; const tr=document.createElement("tr"); tr.innerHTML=`<td class="px-4 py-2">${pointName}</td><td class="px-4 py-2">${od.total.toFixed(2)}</td><td class="px-4 py-2">${new Date(od.timestamp.toDate()).toLocaleString()}</td><td class="px-4 py-2"><button onclick="odDoc.ref.delete()" class="text-red-500">ğŸ—‘</button></td>`; tb.appendChild(tr); }); });
    }
  </script>
</body>
</html>
